"use strict";(self.webpackChunksnjofkalo_ui=self.webpackChunksnjofkalo_ui||[]).push([[272],{5272:(_,l,s)=>{s.r(l),s.d(l,{CheckoutComponent:()=>k});var a=s(177),d=s(9012),i=s(9417),t=s(4438),p=s(6042),g=s(4397);function f(o,c){1&o&&(t.j41(0,"div",4)(1,"p"),t.EFF(2,"Your cart is empty"),t.k0s(),t.j41(3,"a",5),t.EFF(4,"Continue Shopping"),t.k0s()())}function h(o,c){if(1&o&&(t.j41(0,"div",34)(1,"span"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.nI1(5,"currency"),t.k0s()()),2&o){const e=c.$implicit;t.R7$(2),t.Lme("",e.item.title," x ",e.quantity,""),t.R7$(2),t.JRh(t.i5U(5,3,e.item.price*e.quantity,"EUR"))}}function b(o,c){if(1&o){const e=t.RV6();t.j41(0,"div",6)(1,"div",7)(2,"form",8),t.bIt("ngSubmit",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.onSubmit())}),t.j41(3,"div",9)(4,"h2"),t.EFF(5,"Shipping Information"),t.k0s(),t.j41(6,"div",10)(7,"label",11),t.EFF(8,"Full Name"),t.k0s(),t.nrm(9,"input",12),t.k0s(),t.j41(10,"div",10)(11,"label",13),t.EFF(12,"Address"),t.k0s(),t.nrm(13,"input",14),t.k0s(),t.j41(14,"div",15)(15,"div",10)(16,"label",16),t.EFF(17,"City"),t.k0s(),t.nrm(18,"input",17),t.k0s(),t.j41(19,"div",10)(20,"label",18),t.EFF(21,"Postal Code"),t.k0s(),t.nrm(22,"input",19),t.k0s()(),t.j41(23,"div",10)(24,"label",20),t.EFF(25,"Country"),t.k0s(),t.nrm(26,"input",21),t.k0s()(),t.j41(27,"div",9)(28,"h2"),t.EFF(29,"Payment Information"),t.k0s(),t.j41(30,"div",10)(31,"label",22),t.EFF(32,"Card Number"),t.k0s(),t.nrm(33,"input",23),t.k0s(),t.j41(34,"div",15)(35,"div",10)(36,"label",24),t.EFF(37,"Expiry Date"),t.k0s(),t.nrm(38,"input",25),t.k0s(),t.j41(39,"div",10)(40,"label",26),t.EFF(41,"CVV"),t.k0s(),t.nrm(42,"input",27),t.k0s()()(),t.j41(43,"div",9)(44,"h2"),t.EFF(45,"Order Summary"),t.k0s(),t.j41(46,"div",28),t.DNE(47,h,6,6,"div",29),t.k0s(),t.j41(48,"div",30)(49,"div",31)(50,"span"),t.EFF(51,"Subtotal:"),t.k0s(),t.j41(52,"span"),t.EFF(53),t.nI1(54,"currency"),t.k0s()(),t.j41(55,"div",31)(56,"span"),t.EFF(57,"Shipping:"),t.k0s(),t.j41(58,"span"),t.EFF(59),t.nI1(60,"currency"),t.k0s()(),t.j41(61,"div",32)(62,"span"),t.EFF(63,"Total:"),t.k0s(),t.j41(64,"span"),t.EFF(65),t.nI1(66,"currency"),t.k0s()()()(),t.j41(67,"button",33),t.EFF(68),t.k0s()()()()}if(2&o){const e=t.XpG();t.R7$(2),t.Y8G("formGroup",e.checkoutForm),t.R7$(45),t.Y8G("ngForOf",e.cartItems),t.R7$(6),t.JRh(t.i5U(54,7,e.subtotal,"EUR")),t.R7$(6),t.JRh(t.i5U(60,10,e.shipping,"EUR")),t.R7$(6),t.JRh(t.i5U(66,13,e.total,"EUR")),t.R7$(2),t.Y8G("disabled",!e.checkoutForm.valid||e.isSubmitting),t.R7$(),t.SpI(" ",e.isSubmitting?"Processing...":"Place Order"," ")}}function C(o,c){if(1&o&&(t.j41(0,"div",35)(1,"h2"),t.EFF(2,"Order Placed Successfully!"),t.k0s(),t.j41(3,"p"),t.EFF(4),t.k0s(),t.j41(5,"p"),t.EFF(6,"Redirecting you to order confirmation page in a few seconds..."),t.k0s()()),2&o){const e=t.XpG();t.R7$(4),t.JRh(e.orderPlacedMessage)}}let k=(()=>{class o{constructor(e,n,r,F){this.cartService=e,this.ordersService=n,this.router=r,this.fb=F,this.cartItems=[],this.subtotal=0,this.shipping=5.99,this.isSubmitting=!1,this.orderPlacedMessage=null,this.showConfirmation=!1,this.isErrorConfirmation=!1,this.checkoutForm=this.fb.group({fullName:[""],address:[""],city:[""],postalCode:[""],country:[""],cardNumber:[""],expiryDate:[""],cvv:[""]}),this.checkoutForm.get("cardNumber")?.valueChanges.subscribe(m=>{if(m){const u=m.replace(/\D/g,"").replace(/(\d{4})(?=\d)/g,"$1 ").trim();u!==m&&this.checkoutForm.patchValue({cardNumber:u},{emitEvent:!1})}})}ngOnInit(){this.loadCart()}loadCart(){this.cartService.getCart().subscribe({next:e=>{this.cartItems=e,this.calculateSubtotal()},error:e=>{console.error("Failed to load cart items",e),this.cartItems=[]}})}calculateSubtotal(){this.subtotal=this.cartItems.reduce((e,n)=>e+n.item.price*n.quantity,0)}get total(){return this.subtotal+this.shipping}onSubmit(){if(this.checkoutForm.invalid)return void console.error("Form is invalid.");this.isSubmitting=!0;const e={fullName:this.checkoutForm.get("fullName")?.value,address:this.checkoutForm.get("address")?.value,city:this.checkoutForm.get("city")?.value,postalCode:this.checkoutForm.get("postalCode")?.value,country:this.checkoutForm.get("country")?.value},n={shippingAddress:JSON.stringify(e),billingAddress:JSON.stringify(e),cartItems:this.cartItems.map(r=>({itemId:r.itemId,quantity:r.quantity}))};this.ordersService.createOrder(n).subscribe({next:r=>{console.log("Order placed successfully:",r),this.cartService.clearCart().subscribe(()=>{this.isSubmitting=!1,this.orderPlacedMessage=`Your order #${r.data.idOrder} has been placed successfully!`,this.showConfirmation=!0,this.isErrorConfirmation=!1,setTimeout(()=>{this.router.navigate(["/order-confirmation",r.data.idOrder])},3e3)})},error:r=>{console.error("Error placing order:",r),this.isSubmitting=!1,this.orderPlacedMessage=r.error?.message||"Failed to place your order. Please try again.",this.showConfirmation=!0,this.isErrorConfirmation=!0}})}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(p.m),t.rXU(g.B),t.rXU(d.Ix),t.rXU(i.ok))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-checkout"]],standalone:!0,features:[t.aNF],decls:6,vars:3,consts:[[1,"checkout-container"],["class","empty-cart",4,"ngIf"],["class","checkout-content",4,"ngIf"],["class","order-confirmation-message",4,"ngIf"],[1,"empty-cart"],["routerLink","/items",1,"continue-shopping"],[1,"checkout-content"],[1,"checkout-form"],[3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-group"],["for","fullName"],["type","text","id","fullName","formControlName","fullName"],["for","address"],["type","text","id","address","formControlName","address"],[1,"form-row"],["for","city"],["type","text","id","city","formControlName","city"],["for","postalCode"],["type","text","id","postalCode","formControlName","postalCode"],["for","country"],["type","text","id","country","formControlName","country"],["for","cardNumber"],["type","text","id","cardNumber","formControlName","cardNumber","placeholder","1234 5678 9012 3456"],["for","expiryDate"],["type","text","id","expiryDate","formControlName","expiryDate","placeholder","MM/YY"],["for","cvv"],["type","text","id","cvv","formControlName","cvv","placeholder","123"],[1,"order-items"],["class","order-item",4,"ngFor","ngForOf"],[1,"order-total"],[1,"total-row"],[1,"total-row","grand-total"],["type","submit",1,"place-order-btn",3,"disabled"],[1,"order-item"],[1,"order-confirmation-message"]],template:function(n,r){1&n&&(t.j41(0,"div",0)(1,"h1"),t.EFF(2,"Checkout"),t.k0s(),t.DNE(3,f,5,0,"div",1)(4,b,69,16,"div",2)(5,C,7,1,"div",3),t.k0s()),2&n&&(t.R7$(3),t.Y8G("ngIf",0===r.cartItems.length),t.R7$(),t.Y8G("ngIf",r.cartItems.length>0&&!r.showConfirmation),t.R7$(),t.Y8G("ngIf",r.showConfirmation))},dependencies:[a.MD,a.Sq,a.bT,a.oe,d.iI,d.Wk,i.YN,i.qT,i.me,i.BC,i.cb,i.X1,i.j4,i.JD],styles:[".checkout-container[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.empty-cart[_ngcontent-%COMP%]{text-align:center;padding:3rem}.continue-shopping[_ngcontent-%COMP%]{display:inline-block;margin-top:1rem;padding:.75rem 1.5rem;background-color:#3498db;color:#fff;text-decoration:none;border-radius:4px}.checkout-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:2rem}.form-section[_ngcontent-%COMP%]{background-color:#fff;padding:1.5rem;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;color:#2c3e50}input[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #ddd;border-radius:4px;font-size:1rem}.order-items[_ngcontent-%COMP%]{margin:1rem 0}.order-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid #eee}.order-total[_ngcontent-%COMP%]{margin-top:1rem}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:.5rem 0}.grand-total[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;border-top:2px solid #eee;padding-top:1rem;margin-top:1rem}.place-order-btn[_ngcontent-%COMP%]{width:100%;padding:1rem;background-color:#2ecc71;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1.1rem;transition:background-color .3s ease}.place-order-btn[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.place-order-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#27ae60}.order-confirmation-message[_ngcontent-%COMP%]{text-align:center;padding:3rem;background-color:#e6ffe6;border-radius:8px;box-shadow:0 2px 4px #0000001a;color:#28a745}.order-confirmation-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#28a745;margin-bottom:1rem}.order-confirmation-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.5rem}"]})}}return o})()}}]);