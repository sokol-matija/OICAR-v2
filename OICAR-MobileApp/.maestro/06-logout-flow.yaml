appId: com.oicar.mobileapp
---
# ðŸ§ª E2E Test: Logout Flow
# Tests: Session termination â†’ JWT invalidation â†’ Security cleanup

- launchApp
- assertVisible: "OICAR"

# Ensure user is logged in first
- tapOn: "Login"
- inputText: "testuser_1234"
- tapOn: "Password"
- inputText: "TestPassword123"
- tapOn: "Sign In"
- assertVisible: "Dashboard"

# Verify authenticated state
- assertVisible: "Welcome back"
- assertVisible: "My Profile"
- assertVisible: "My Cart"
- assertVisible: "Logout"

# Navigate to profile to verify user data
- tapOn: "My Profile"
- assertVisible: "Profile Information"
- assertVisible: "testuser_1234"
- assertVisible: "Settings"

# Initiate logout process
- tapOn: "Logout"

# Confirm logout (if confirmation dialog exists)
- assertVisible: "Are you sure you want to logout?"
- tapOn: "Yes, Logout"

# Wait for logout API call completion
- assertVisible:
    text: "Logging out"
    timeout: 3000

# Verify logout success
- assertVisible:
    text: "Logged out successfully"
    timeout: 5000

# Verify return to unauthenticated state
- assertVisible: "Welcome to OICAR"
- assertVisible: "Login"
- assertVisible: "Register"

# Verify protected features not accessible
- assertNotVisible: "My Profile"
- assertNotVisible: "My Cart"
- assertNotVisible: "Dashboard"
- assertNotVisible: "Logout"

# Test that login is required for protected actions
- tapOn: "Browse Items"
- tapOn:
    text: "View Details"
    index: 0
- tapOn: "Add to Cart"

# Should prompt for login
- assertVisible: "Please login to add items to cart"
- assertVisible: "Login Now"

# Verify session completely cleared
- tapOn: "Login Now"
- assertVisible: "Sign In"
- assertNotVisible: "testuser_1234"  # Username not pre-filled

# Test failed access to protected API endpoints
- tapOn: "Back"
- tapOn: "Back"
# Try to access profile directly (should redirect to login)
- assertVisible: "Welcome to OICAR"

---
# ðŸŽ¯ What this test validates:
# âœ… Logout API endpoint (/api/auth/logout) integration
# âœ… JWT token invalidation on server
# âœ… Local token removal from device storage
# âœ… Session state cleanup in React Native
# âœ… Protected route access restrictions
# âœ… UI state reset to unauthenticated
# âœ… Security: No residual authenticated data
# âœ… Proper redirect flows for protected actions 